<view class="container page-enter">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">è®¡ç®—å†å²</text>
    <text class="page-subtitle">æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„è®¡ç®—è®°å½•</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{records.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-title">æš‚æ— è®¡ç®—è®°å½•</view>
    <view class="empty-subtitle">å¼€å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡ææ–™è®¡ç®—å§</view>
    <button class="btn-primary haptic-medium" bindtap="goToCalculate">
      <text class="btn-text">å¼€å§‹è®¡ç®—</text>
      <text class="btn-arrow">â†’</text>
    </button>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-container" wx:else>
    <view class="record-card haptic-light" wx:for="{{records}}" wx:key="_id">
      <view class="record-header">
        <view class="material-info">
          <view class="material-badge">{{item.material}}</view>
          <view class="record-meta">
            <text class="record-time">{{item.formatTime}}</text>
            <view class="advanced-indicator" wx:if="{{item.isAdvanced}}">
              <text class="advanced-text">é«˜çº§</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="record-body">
        <!-- ä¸»è¦ç»“æœ -->
        <view class="main-result">
          <view class="result-label">å»ºè®®ç”¨é‡</view>
          <view class="result-amount">
            <text class="amount-number">{{item.result}}</text>
            <text class="amount-unit">{{item.resultUnit}}</text>
          </view>
        </view>

        <!-- è¯¦ç»†ä¿¡æ¯ -->
        <view class="detail-grid">
          <view class="detail-item">
            <text class="detail-label">é¢ç§¯</text>
            <text class="detail-value">{{item.area}}{{item.unit}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æŸè€—ç‡</text>
            <text class="detail-value">{{item.wasteRate}}%</text>
          </view>
          <view class="detail-item" wx:if="{{item.layout}}">
            <text class="detail-label">é“ºè´´æ–¹å¼</text>
            <text class="detail-value">{{item.layout}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.rooms && item.rooms.length > 1}}">
            <text class="detail-label">æˆ¿é—´æ•°</text>
            <text class="detail-value">{{item.rooms.length}}ä¸ª</text>
          </view>
        </view>

        <!-- æˆ¿é—´åˆ—è¡¨ -->
        <view class="room-tags" wx:if="{{item.rooms && item.rooms.length > 1}}">
          <view class="room-tag" wx:for="{{item.rooms}}" wx:key="index" wx:for-item="room">
            {{room.name}}
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="record-actions">
        <button class="action-btn recalc haptic-light" bindtap="recalculate" data-record="{{item}}">
          <text class="action-icon">ğŸ”„</text>
          <text class="action-text">é‡ç®—</text>
        </button>
        <button class="action-btn copy haptic-light" bindtap="copyRecord" data-record="{{item}}">
          <text class="action-icon">ğŸ“‹</text>
          <text class="action-text">å¤åˆ¶</text>
        </button>
        <button class="action-btn delete haptic-light" bindtap="deleteRecord" data-id="{{item._id}}">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text class="action-text">åˆ é™¤</text>
        </button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more-section" wx:if="{{records.length > 0 && hasMore}}">
    <button class="load-more-btn haptic-light" bindtap="loadMore" disabled="{{loadingMore}}">
      <text class="load-more-text">{{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
    </button>
  </view>
</view>