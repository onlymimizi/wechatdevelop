<view class="container page-enter {{isDarkTheme ? 'dark' : ''}}">
  <!-- æ¨¡æ¿æç¤º -->
  <view wx:if="{{fromTemplate}}" class="template-tip {{isDarkTheme ? 'dark' : ''}}">
    <text class="tip-icon">ğŸ“„</text>
    <text class="tip-text">æ­£åœ¨ä½¿ç”¨æ¨¡æ¿ï¼š{{templateName}}</text>
  </view>

  <!-- ææ–™ä¿¡æ¯å¤´éƒ¨ -->
  <view class="material-header {{isDarkTheme ? 'dark' : ''}}">
    <view class="material-badge">{{params.material}}</view>
    <view class="material-info">åŸºç¡€é¢ç§¯ {{params.area}}ã¡</view>
  </view>

  <!-- æˆ¿é—´åˆ—è¡¨ -->
  <view class="card {{isDarkTheme ? 'dark' : ''}}">
    <view class="flex-between mb-16">
      <view class="card-title">æˆ¿é—´è¯¦æƒ…</view>
      <button class="add-room-btn haptic-light {{isDarkTheme ? 'dark' : ''}}" bindtap="addRoom">
        <text class="add-icon">+</text>
        <text>æ·»åŠ æˆ¿é—´</text>
      </button>
    </view>

    <view class="room-list">
      <view class="room-card {{isDarkTheme ? 'dark' : ''}}" wx:for="{{rooms}}" wx:key="index">
        <view class="room-header">
          <input 
            class="room-name-input {{isDarkTheme ? 'dark' : ''}}" 
            placeholder="æˆ¿é—´åç§°"
            value="{{item.name}}"
            bindinput="onRoomNameInput"
            data-index="{{index}}"
          />
          <button 
            class="delete-room-btn haptic-light {{isDarkTheme ? 'dark' : ''}}" 
            bindtap="deleteRoom" 
            data-index="{{index}}"
            wx:if="{{rooms.length > 1}}"
          >
            Ã—
          </button>
        </view>

        <view class="dimension-inputs">
          <view class="dimension-row">
            <view class="dimension-input">
              <view class="dimension-label">é•¿åº¦</view>
              <input 
                class="dimension-field {{isDarkTheme ? 'dark' : ''}}" 
                type="digit" 
                placeholder="0"
                value="{{item.length}}"
                bindinput="onRoomDimensionInput"
                data-index="{{index}}"
                data-field="length"
              />
              <text class="dimension-unit">m</text>
            </view>
            
            <text class="multiply-symbol">Ã—</text>
            
            <view class="dimension-input">
              <view class="dimension-label">å®½åº¦</view>
              <input 
                class="dimension-field {{isDarkTheme ? 'dark' : ''}}" 
                type="digit" 
                placeholder="0"
                value="{{item.width}}"
                bindinput="onRoomDimensionInput"
                data-index="{{index}}"
                data-field="width"
              />
              <text class="dimension-unit">m</text>
            </view>
          </view>

          <view class="area-result">
            <text class="area-label">é¢ç§¯</text>
            <text class="area-value">{{item.area || 0}} ã¡</text>
          </view>

          <!-- é«˜çº§é€‰é¡¹ -->
          <view class="advanced-section" wx:if="{{params.isAdvanced}}">
            <view class="advanced-header">
              <text class="advanced-title">é«˜çº§é€‰é¡¹</text>
            </view>
            
            <view class="input-group">
              <view class="input-label">æ‰£é™¤é¢ç§¯ (é—¨çª—ç­‰)</view>
              <view class="input-wrapper">
                <input 
                  class="input-field {{isDarkTheme ? 'dark' : ''}}" 
                  type="digit" 
                  placeholder="0"
                  value="{{item.deductArea}}"
                  bindinput="onRoomDimensionInput"
                  data-index="{{index}}"
                  data-field="deductArea"
                />
                <text class="input-unit">ã¡</text>
              </view>
            </view>
            
            <view class="input-group">
              <view class="input-label">ç‰¹æ®Šç³»æ•°</view>
              <picker 
                bindchange="onSpecialCoefficientChange" 
                value="{{item.specialCoefficientIndex || 0}}" 
                range="{{specialCoefficientOptions}}"
                data-index="{{index}}"
              >
                <view class="ios-picker {{isDarkTheme ? 'dark' : ''}}">
                  <text class="picker-text">{{specialCoefficientOptions[item.specialCoefficientIndex || 0]}}</text>
                  <text class="picker-arrow">â€º</text>
                </view>
              </picker>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å•ä½åˆ‡æ¢ -->
  <view class="card {{isDarkTheme ? 'dark' : ''}}">
    <view class="card-title">å•ä½è®¾ç½®</view>
    <view class="unit-selector">
      <button 
        class="unit-option {{unit === 'ã¡' ? 'active' : ''}} {{isDarkTheme ? 'dark' : ''}}"
        bindtap="switchUnit"
        data-unit="ã¡"
      >
        å¹³æ–¹ç±³ (ã¡)
      </button>
      <button 
        class="unit-option {{unit === 'åª' ? 'active' : ''}} {{isDarkTheme ? 'dark' : ''}}"
        bindtap="switchUnit"
        data-unit="åª"
      >
        åª
      </button>
    </view>
  </view>

  <!-- æ€»è®¡ä¿¡æ¯ -->
  <view class="summary-card {{isDarkTheme ? 'dark' : ''}}">
    <view class="summary-header">
      <text class="summary-title">è®¡ç®—æ±‡æ€»</text>
    </view>
    <view class="summary-content">
      <view class="summary-item">
        <text class="summary-label">æ€»é¢ç§¯</text>
        <text class="summary-value">{{totalArea}}{{unit}}</text>
      </view>
      <view class="summary-item" wx:if="{{params.isAdvanced && totalDeductArea > 0}}">
        <text class="summary-label">æ‰£é™¤é¢ç§¯</text>
        <text class="summary-value deduct">-{{totalDeductArea}}{{unit}}</text>
      </view>
      <view class="divider"></view>
      <view class="summary-item final">
        <text class="summary-label">å®é™…é¢ç§¯</text>
        <text class="summary-value highlight">{{actualArea}}{{unit}}</text>
      </view>
    </view>
  </view>

  <!-- å…è´£å£°æ˜ -->
  <view class="disclaimer {{isDarkTheme ? 'dark' : ''}}">
    <view class="disclaimer-title">
      <text class="ios-icon">âš ï¸</text>
      <text>å…è´£å£°æ˜</text>
    </view>
    <view class="disclaimer-text">
      è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…ç”¨é‡å¯èƒ½å› æ–½å·¥å·¥è‰ºã€ææ–™æ‰¹å·ç­‰å› ç´ ç•¥æœ‰å·®å¼‚ï¼Œè¯·ä»¥å®é™…æƒ…å†µä¸ºå‡†ã€‚
    </view>
  </view>

  <!-- è®¡ç®—æŒ‰é’® -->
  <view class="action-section safe-area-bottom">
    <button 
      class="btn-primary haptic-medium {{canCalculate ? '' : 'disabled'}} {{isDarkTheme ? 'dark' : ''}}" 
      bindtap="calculate" 
      disabled="{{!canCalculate}}"
    >
      <text class="btn-text">è®¡ç®—ææ–™ç”¨é‡</text>
      <text class="btn-arrow">â†’</text>
    </button>
  </view>
</view>